@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@using System.Data;
@model DataTable;

<main class="main" id="main">


    <div class="border rounded p-5 ">
        <div class="d-flex justify-content-between align-items-center ">
            <h3 class="fw-bold"><i class="ri-restaurant-line me-2" style="font-size: 20px"></i>Restaurants</h3>
            <a asp-area="Admin" asp-controller="Restaurant" asp-action="AddEdit">
                <button class="btn btn-sm btn-primary">
                    Add Restaurant
                </button>
            </a>
        </div>

        <div class="w-25 ms-auto my-3">
            <div class="input-group datatables_filter" id="sample_1_filter">
                <div class="input-group-text bg-transparent" style="font-size: 15px"><i class="bi bi-search"></i></div>
                <input type="text" class="form-control input-sm input-small input-inline" id="sample_1" aria-controls="sample_1" placeholder="Search here">
            </div>
        </div>

        <hr />





        <form asp-area="Admin" asp-controller="Restaurant" asp-action="RestaurantFilter">
            <div class="row">
                <div class="w-25  my-3">
                    <label class="visually-hidden" for="autoSizingInputGroup">Restaurant name</label>
                    <div class="input-group">
                        <div class="input-group-text bg-transparent" style="font-size: 15px"><i class="bi bi-search"></i></div>
                        <input type="text" class="form-control" id="Name" name="Name" placeholder="Search Restaurant Name here">
                        @* <input type="hidden" name="BranchName" value="BranchName" />*@
                    </div>
                </div>

                <div class="w-25  my-3">
                    <label class="visually-hidden" for="autoSizingInputGroup">Address</label>
                    <div class="input-group">
                        <div class="input-group-text bg-transparent" style="font-size: 15px"><i class="bi bi-search"></i></div>
                        <input type="text" class="form-control" id="Address" name="Address" placeholder="Search by Address ">
                        @* <input type="hidden" name="BranchName" value="BranchName" />*@
                    </div>
                </div>

                <div class="w-25  my-3">
                    <label class="visually-hidden" for="autoSizingInputGroup">IsActive</label>
                    <div class="input-group">
                        <div class="input-group-text bg-transparent" style="font-size: 15px"><i class="bi bi-search"></i></div>
                        <input type="text" class="form-control" id="IsActive" name="IsActive" placeholder="Search for Active Restaurant ">
                        @* <input type="hidden" name="BranchName" value="BranchName" />*@
                    </div>
                </div>
                <div class="row pb-2">
                    <div class="w-auto my-3">
                        <div class="input-group">
                            <input type="submit" asp-action="RestaurantFilter" class="btn btn-primary" value="Apply Filter" />
                        </div>
                    </div>

                    <div class="w-auto my-3">
                        <div class="input-group">
                            <input type="submit" asp-action="RestaurantList" class="btn btn-secondary" value="Clear Filter"  />
                        </div>
                    </div>
                </div>
            </div>
        </form>


        <hr />

        <form id="deleteForm" asp-area="Admin" asp-controller="Restaurant" asp-action="MultipleDelete" method="post">
            <input type="button" class="btn btn-primary" value="Delete" onclick="deleteSelected()" />
            <input type="hidden" name="selectedRestaurantIDs" id="selectedRestaurantIDs" />
        </form>

        <br />
        
        <div>
            <table class="table table-striped table-bordered" id="">
                <thead>
                    <tr>
                        <th>Delete</th>
                        <th>Active</th>

                        <th>Name</th>

                        <th>Address</th>
                        <th>PhoneNo</th>
                        <th>Email</th>

                        <th colspan="3">Actions</th>
                    </tr>
                </thead>


                <tbody id="sample_2">
                    @foreach (DataRow dr in Model.Rows)
                    {
                        <tr>
                            <td>
                                <input type="checkbox" name="selectedRestaurants" value="@Convert.ToInt32(dr["RestaurantID"])"/>
                            </td>
                            <td>
                                @{
                                    if (Convert.ToBoolean(dr["IsActive"]))
                                    {
                                                    <i class="bi bi-circle-fill" style="color:mediumseagreen"></i>
                                    }
                                    else
                                    {
                                                    <i class="bi bi-circle-fill" style="color: red"></i>
                                    }
                                }
                            </td>

                            <td>@dr["Name"]</td>

                            <td>@dr["CityName"]</td>
                            <td>@dr["PhoneNo"]</td>
                            <td>@dr["Email"]</td>

                            <td>
                                <form asp-area="Admin" asp-controller="FoodCategory" asp-action="FoodCategoryList">
                                    <input type="hidden" name="RestaurantID" value="@Convert.ToInt32(dr["RestaurantID"])" />
                                   

                                    <button class="btn btn-light rounded-3">
                                        View
                                    </button>
                                </form>
                            </td>

                            <td>
                                <form asp-area="Admin" asp-controller="Restaurant" asp-action="AddEdit">
                                    <input type="hidden" value="@Convert.ToInt32(dr["RestaurantID"])" name="RestaurantID" />
                                    <button class="btn btn-warning rounded-3">
                                        <i class="ri-edit-line"></i>
                                    </button>
                                </form>
                            </td>

                            <td>
                                <form asp-area="Admin" asp-controller="Restaurant" asp-action="Delete">
                                    <input type="hidden" value="@Convert.ToInt32(dr["RestaurantID"])" name="RestaurantID" />
                                    <button class="btn btn-outline-danger rounded-3" onclick="return confirmDelete()">
                                        <i class="ri-delete-bin-6-line"></i>
                                    </button>
                                </form>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        @* <div class="d-flex flex-wrap">
        @foreach (DataRow dr in Model.Rows)
        {
        <div class="col-sm-6 col-md-4 col-lg-3 h-100 mb-5 p-3">
        <div class="card card-span h-100 text-white rounded-3">
        <img class="img-fluid rounded-3 h-100" src=@dr["ImageUrl"] alt="..." />
        <div class="card-img-overlay ps-0 ">
        <span class="badge bg-danger p-2 ms-3"><i class="fas fa-tag me-2 fs-0"></i><span class="fs-0">20% off</span></span>
        <span class="badge bg-primary ms-2 me-1 p-2"><i class="fas fa-clock me-1 fs-0"></i><span class="fs-0">Fast</span></span>
        </div>
        <div class="card-body ps-0">
        <div class="d-flex align-items-center mb-3">
        <img class="img-fluid" src="~/assets/img/gallery/food-world-logo.png" alt="" />
        <div class="flex-1 ms-3">
        <h5 class="mb-0 fw-bold text-1000">@dr["Name"]</h5>
        <span class="text-primary fs--1 me-1"><i class="fas fa-star"></i></span>
        <span class="mb-0 text-primary">@dr["NumReviews"]</span>
        </div>
        </div>
        <span class="badge bg-soft-danger p-2"><span class="fw-bold fs-1 text-danger">Opens Tomorrow</span></span>
        </div>
        </div>
        </div>
        }
        </div> *@

    </div>
</main>

@section Scripts{

    <script>
        $(document).ready(function () {
            $("#sample_1").on("keyup", function () {
                var value = $(this).val().toLowerCase();
                $("#sample_2 tr").filter(function () {
                    $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
                });
            });
        });

        function confirmDelete() {
            if (confirm("Are you sure to delete record?"))
                return true;

            else
                return false;
        }

        function deleteSelected(){
            console.log("Deleting selected ...");

            var form = document.getElementById("deleteForm");
            var checkboxes = document.getElementsByName("selectedRestaurants");
            var selectedRestaurantIDs = [];
            

            checkboxes.forEach(function (checkbox) {
                if (checkbox.checked) {
                    selectedRestaurantIDs.push(checkbox.value);
                }
            });

            document.getElementById("selectedRestaurantIDs").value = selectedRestaurantIDs.join(',');
           

            console.log("Submitting ...");
            form.submit();
        }
    </script>

}
